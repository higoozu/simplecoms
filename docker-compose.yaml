version: "3.9"
services:
  comment-service:
    build: .
    container_name: comment-service
    ports:
      - "8080:8080" # host:container
    environment:
      NODE_ENV: production # runtime mode
      PORT: 8080 # server port

      # Local testing switches
      LOCAL_TEST: "0" # enable localhost routing in dev
      LOCAL_ADMIN_BYPASS: "0" # bypass admin header in dev

      # Backup
      BACKUP_ENABLED: "true" # enable daily backup job

      # Email provider
      EMAIL_PROVIDER: resend # resend or sendgrid
      RESEND_API_KEY: "" # resend api key
      SENDGRID_API_KEY: "" # sendgrid api key
      EMAIL_FROM: "noreply@yourdomain.com" # from email address
      EMAIL_FROM_NAME: "Your Site" # from display name
      PUBLIC_SITE_URL: https://domain.com # used in user email links
      SMTP_HOST: "" # smtp host
      SMTP_PORT: "587" # smtp port
      SMTP_SECURE: "false" # true for SMTPS
      SMTP_USER: "" # smtp username
      SMTP_PASS: "" # smtp password

      # Turnstile
      TURNSTILE_SECRET_KEY: "" # cloudflare turnstile secret

      # Zero Trust admin
      ADMIN_EMAILS: "admin@example.com,editor@example.com" # allowed admin emails
      ALLOWED_COUNTRIES: "" # optional access restriction
      ADMIN_CONFIG_PATH: /app/config/admins.json # admin profiles path
      # ADMIN_PROFILES_JSON: "[]" # optional inline admin profiles JSON

      # Logging
      LOG_LEVEL: info # debug|info|warn|error
      LOG_DIR: /app/logs # container log directory

      # Domains
      ADMIN_DOMAIN: comment-admin.yourdomain.com # admin host
      API_DOMAIN: comment.yourdomain.com # api host
      PUBLIC_BASE_URL: https://comment.yourdomain.com # fallback base url
      ALLOWED_ORIGINS: https://domain.com # cors allowed origins

      # Feature toggles
      ENABLE_COMMENT_MODERATION: "true"
      ENABLE_EMAIL_NOTIFICATIONS: "true"
      ENABLE_AUDIT_LOG: "true"
      ENABLE_APPROVAL_EMAILS: "true"
      ENABLE_TELEGRAM_NOTIFICATIONS: "true"

      # Settings defaults
      AUTO_APPROVE: "false"
      REQUIRE_EMAIL: "true"
      MAX_COMMENT_LENGTH: "5000"
      MIN_COMMENT_LENGTH: "1"
      COMMENT_MODERATION_EMAIL: ""
      AUTO_APPROVE_THRESHOLD: "0.3"
      ENABLE_NESTED_EMAILS: "true"

      # Akismet
      AKISMET_KEY: ""
      AKISMET_BLOG: https://your-blog-domain.com
      SPAM_THRESHOLD: "0.7"

      # Gravatar
      GRAVATAR_CDN: https://www.gravatar.com/avatar
      GRAVATAR_DEFAULT_THEME: identicon

      # Security
      TOKEN_SECRET: "change_me"

      # Telegram notifications
      TELEGRAM_BOT_TOKEN: ""
      TELEGRAM_CHAT_ID: ""
    volumes:
      - ./data:/app/data # sqlite database
      - ./backups:/app/backups # backups
      - ./logs:/app/logs # log files
      - ./config:/app/config # admin profiles
